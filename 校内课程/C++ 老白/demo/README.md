# 说明


## 一、构建环境

1. 编译环境
   
    为展示C++最新标准的特性，本课程资源要求C++编译器能支持`C++ 23`标准。为此，本课程资源提供的构建系统可以工作在如下系统和环境中：

    |操作系统|编译器|可替代品|
    |:---:|:---:|:---:|
    |Linux（含WSL）|GCC 13+|Clang 16+|
    |macOS|GCC 13+|Clang 16+|
    |Windows 11|MinGW GCC 13+|MSVC++ 19+|

    >支持gcc 13的Linux系统有Ubuntu 23.04。MinGW GCC 13.1我会共享给大家。

2. 支持系统

    辅助构建环境需要使用`Python`。

    请确认你的系统中安装了最新版`Python`（目前是3.11）。

---

## 二、辅助构建工具zmake

1. 使用zmake

    为了能方便地构建应用，本课程资源提供了一个`Shell`脚本+`Python`脚本的解决方案。使用方法是：
    ```bash
    cd 课程资源目录
    zmake -b 源文件名或者源目录名
    ```
    要获得更多的信息，请运行：
    ```bash
    zmake -h
    ```

2. 配置zmake
   
   `zmake`的配置写在了配置文件`zmake-configure.yaml`中。

   可以修改`active`的值以适配你的默认编译器。
   >注：如果你的编译器是MinGW，那么你可以不必显式指定active是MinGW，而是仍然使用g++。zmake会自动探测并启用适配的选项。

---

## 三、关于C++模块（modules）

1. 生成系统模块

    到目前为止，`GCC`还没有提供系统范围内的预制模块。所以，在构建本课程资源应用之前，你需要手动生成所需要的所有系统（头文件对应的）模块。具体方法是，在终端中发出类似如下的命令：
    ```bash
    ./tool/mksysmod iostream string
    ```
    这个Shell脚本将在当前目录下生成所需的系统模块。这些模块存放在当前目录下的`gcm.cache`目录中。

    如果要一次生成本课程资源用到的多个系统模块，那么请发出如下指令：
    ```bash
    ./tool/mkgcms
    ```

    >注：C++23对模块的支持并不完善。编译系统头文件到模块需要按照一定的顺序，否则可能会出错。

2. 自己编写的模块

    如果你自己编写了使用模块的应用，那么你需要注意以下几点：
    - 模块源文件的后缀名
  
        C++标准没有明确规定。但`g++`的源文件除了预定义的`.cpp`、`.cpp`、`.cc`等，不支持新的后缀名。因此，模块源文件的后缀名不妨仍用`.cpp`，不过在命名上要给出依赖先后顺序。例如：`0.cpp`、`1.cpp`、`main.cpp`等。

    - 模块的编译

        模块必须在引用它们的编译单元之前编译。例如，
        - 有模块源文件`a.cpp`，其中有模块`A`的声明
        - 有模块源文件`b.cpp`，其中有模块`B`的声明，并且有`import A;`这一句
        - `main.cpp`中有`import B;`这句
        
        那么编译顺序必须是这样的：
        ```bash
        g++ a.cpp b.cpp main.cpp
        ```

3. 编译使用模块的程序出错
    
    - 如果发现是缺少未编译的模块，那么请用`mksysmod`来生成它们。
    - 如果出现内部错误，那么请将源代码中的`import <xxx>;`改为：`#include <xxx>`。
